{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block body %}

  {% if mode == 'teacher' %}
    <!-- ===================== TEACHER DASHBOARD (NEW) ===================== -->
    <h1>Teacher Dashboard</h1>
    <p>Welcome, {{ current_user.username }}.</p>

    {% for c in teacher_classes %}
      <h2>{{ c.class_name }} ({{ c.class_time }})</h2>
      <p>Enrollment: {{ c.enrollments|length }}/{{ c.class_capacity }}</p>

      <table border="1" cellspacing="0" cellpadding="8">
        <thead>
          <tr>
            <th>Student</th>
            <th>Grade</th>
            <th>Edit</th>
          </tr>
        </thead>
        <tbody>
          {% for e in c.enrollments %}
          <tr>
            <td>{{ e.student.user.username }}</td>
            <td id="grade-{{ e.enrollment_id }}">{{ e.grade or "N/A" }}</td>
            <td>
              <button onclick="updateGrade('{{ e.enrollment_id}}')">
                Edit Grade
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endfor %}

    <p><a href="{{ url_for('auth.logout') }}">Log out</a></p>

  {% else %}
    <!-- ===================== STUDENT DASHBOARD (existing) ===================== -->
    <h1>Dashboard</h1>
    <p>Welcome, {{ current_user.username }}.</p>

    <div style="margin-bottom: 20px;">
      <button onclick="showTab('current')">Your Classes</button>
      <button onclick="showTab('add')">Add Classes</button>
    </div>

    <div id="current-classes">
      <table border="1" cellspacing="0" cellpadding="8">
          <thead>
              <tr>
                  <th>Class Name</th>
                  <th>Teacher</th>
                  <th>Time</th>
                  <th>Enrollment</th>
              </tr>
          </thead>
          <tbody>
              {% for c in classes %}
              <tr>
                  <td>{{ c.class_name }}</td>
                  <td>{{ c.teacher.user.username }}</td>
                  <td>{{ c.class_time }}</td>
                  <td>
                      {{ c.enrollments|length }}/{{ c.class_capacity }}
                  </td>
              </tr>
              {% endfor %}
          </tbody>
      </table>
    </div>

    <div id="add-classes" style="display:none;">
      <table border="1" cellspacing="0" cellpadding="8">
          <thead>
              <tr>
                  <th>Class Name</th>
                  <th>Teacher</th>
                  <th>Time</th>
                  <th>Enrollment</th>
                  <th>Add/Drop</th>
              </tr>
          </thead>
          <tbody>
              {% for c in allClasses %}
              <tr>
                  <td>{{ c.class_name }}</td>
                  <td>{{ c.teacher.user.username }}</td>
                  <td>{{ c.class_time }}</td>
                  <td>{{ c.enrollments|length }}/{{ c.class_capacity }}</td>
                  <td>
                      {% if c.enrollments|length >= c.class_capacity %}
                          <span style="color: red; font-weight: bold; margin-left: 8px;">FULL</span>
                      {% else %}
                          <button onclick="toggleClass('{{ c.class_id }}')" style="margin-left: 8px;">
                              {% if c in classes %}
                                  -
                              {% else %}
                                  +
                              {% endif %}
                          </button>
                      {% endif %}
                  </td>
              </tr>
              {% endfor %}
          </tbody>
      </table>
    </div>

    <p><a href="{{ url_for('auth.logout') }}">Log out</a></p>

  {% endif %}

  <script src="{{ url_for('static', filename='js/index.js') }}"></script>
{% endblock %}
