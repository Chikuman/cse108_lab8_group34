{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block body %}

  {% if mode == 'teacher' %}
    <!-- ===================== TEACHER DASHBOARD (NEW) ===================== -->
    <h1>Teacher Dashboard</h1>
    <hr class="line">
    <p style="margin-bottom: 3rem;">Welcome, {{ current_user.username }}.</p>

    {% for c in teacher_classes %}
      <h2>{{ c.class_name }} ({{ c.class_time }})</h2>
      <p>Enrollment: {{ c.enrollments|length }}/{{ c.class_capacity }}</p>

      <table border="1" cellspacing="0" cellpadding="8" style="margin-bottom: 2rem;">
        <thead>
          <tr>
            <th style="width: 70%;">Student</th>
            <th style="width: 30%;">Grade</th>
          </tr>
        </thead>
        <tbody>
          {% for e in c.enrollments %}
          <tr>
            <td>{{ e.student.user.username }}</td>
            <td id="grade-{{ e.enrollment_id }}">
              <button. style="background: none; color: #4652a3; cursor: pointer;" onclick="updateGrade('{{ e.enrollment_id}}')">
                {{ e.grade or "N/A" }}
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endfor %}

  {% else %}
    <!-- ===================== STUDENT DASHBOARD (existing) ===================== -->
    <h1>Dashboard</h1>
    <hr class="line">
    <p>Welcome, {{ current_user.username }}.</p>

    <div class="button-container">
      <button class="selector-button" onclick="showTab('current')">Your Classes</button>
      <button class="selector-button" onclick="showTab('add')">Add Classes</button>
    </div>

    <div id="current-classes">
      <table border="1" cellspacing="0" cellpadding="8" style="margin-top: 0;">
          <thead>
              <tr>
                  <th>Class Name</th>
                  <th>Teacher</th>
                  <th>Time</th>
                  <th>Enrollment</th>
              </tr>
          </thead>
          <tbody>
              {% for c in classes %}
              <tr>
                  <td>{{ c.class_name }}</td>
                  <td>{{ c.teacher.user.username }}</td>
                  <td>{{ c.class_time }}</td>
                  <td>
                      {{ c.enrollments|length }}/{{ c.class_capacity }}
                  </td>
              </tr>
              {% endfor %}
          </tbody>
      </table>
    </div>

    <div id="add-classes" style="display:none;">
      <table border="1" cellspacing="0" cellpadding="8" style="margin-top: 0;">
          <thead>
              <tr>
                  <th>Class Name</th>
                  <th>Teacher</th>
                  <th>Time</th>
                  <th>Enrollment</th>
                  <th>Add/Drop</th>
              </tr>
          </thead>
          <tbody>
              {% for c in allClasses %}
              <tr>
                  <td>{{ c.class_name }}</td>
                  <td>{{ c.teacher.user.username }}</td>
                  <td>{{ c.class_time }}</td>
                  <td>{{ c.enrollments|length }}/{{ c.class_capacity }}</td>
                  <td>
                    <div style="display: flex; justify-content: center;">
                      {% if c in classes %}
                          <button onclick="toggleClass('{{ c.class_id }}')" class="add-drop-class">-</button>

                      {% else %}
                          {% if c.enrollments|length >= c.class_capacity %}
                              <span style="color: red; font-weight: bold;">FULL</span>
                          {% else %}
                              <button onclick="toggleClass('{{ c.class_id }}')" class="add-drop-class">+</button>
                          {% endif %}
                      {% endif %}
                    </div>
                  </td>
              </tr>
              {% endfor %}
          </tbody>
      </table>
    </div>
    {% endif %}

    <button style="font-size: 20px; margin-top: 1.5rem; background-color: rgb(195, 46, 46);">
      <a 
        style="text-decoration: none; color: white;" 
        href="{{ url_for('auth.logout') }}"
      >Log out</a>
    </button>

  <script src="{{ url_for('static', filename='js/index.js') }}"></script>
{% endblock %}
